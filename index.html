<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аналітичний Дашборд Продажів</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .category-btn {
            transition: all 0.2s ease;
        }
        .category-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-slate-900 mb-2">Аналітичний Дашборд Продажів</h1>
            <p class="text-slate-600">Мережа магазинів Vape/Hookah | Вересень '25 - Січень '26</p>
        </div>

        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="stat-card bg-white rounded-lg shadow p-6">
                <div class="text-slate-600 text-sm font-medium mb-1">ЗАГАЛЬНИЙ ВИТОРГ</div>
                <div class="text-3xl font-bold text-blue-600" id="totalRevenue">21,429,880 ₴</div>
                <div class="text-green-600 text-sm mt-2" id="revenueChange"></div>
            </div>
            <div class="stat-card bg-white rounded-lg shadow p-6">
                <div class="text-slate-600 text-sm font-medium mb-1">ЗАГАЛЬНИЙ ПРИБУТОК</div>
                <div class="text-3xl font-bold text-green-600" id="totalMargin">9,218,732 ₴</div>
                <div class="text-blue-600 text-sm mt-2" id="marginPercent">43.0%</div>
            </div>
            <div class="stat-card bg-white rounded-lg shadow p-6">
                <div class="text-slate-600 text-sm font-medium mb-1">СЕРЕДНЯ МАРЖА</div>
                <div class="text-3xl font-bold text-amber-600" id="avgMargin">43.0%</div>
                <div class="text-slate-500 text-sm mt-2">За весь період</div>
            </div>
            <div class="stat-card bg-white rounded-lg shadow p-6">
                <div class="text-slate-600 text-sm font-medium mb-1">ТОП КАТЕГОРІЯ</div>
                <div class="text-2xl font-bold text-slate-900">Готові рідини</div>
                <div class="text-slate-600 text-sm mt-2">47.1% маржа</div>
            </div>
        </div>

        <!-- Category Filter Buttons -->
        <div class="mb-6">
            <div class="bg-white rounded-lg shadow p-4">
                <div class="flex flex-wrap gap-2">
                    <button onclick="selectCategory('all')" id="btn-all" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-900 text-white">
                        ВСЬОГО
                    </button>
                    <button onclick="selectCategory(0)" id="btn-0" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-200 text-slate-700">
                        ГОТОВІ РІДИНИ
                    </button>
                    <button onclick="selectCategory(1)" id="btn-1" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-200 text-slate-700">
                        КАРТРИДЖІ
                    </button>
                    <button onclick="selectCategory(2)" id="btn-2" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-200 text-slate-700">
                        КОМПОНЕНТИ
                    </button>
                    <button onclick="selectCategory(3)" id="btn-3" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-200 text-slate-700">
                        ПОДИ
                    </button>
                    <button onclick="selectCategory(4)" id="btn-4" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-200 text-slate-700">
                        ЧАЙНА СУМІШ
                    </button>
                    <button onclick="selectCategory(5)" id="btn-5" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-200 text-slate-700">
                        ВИПАРНИКИ
                    </button>
                    <button onclick="selectCategory(6)" id="btn-6" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-200 text-slate-700">
                        ОДНОРАЗКИ
                    </button>
                    <button onclick="selectCategory(7)" id="btn-7" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-200 text-slate-700">
                        СНЮС
                    </button>
                    <button onclick="selectCategory(8)" id="btn-8" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-200 text-slate-700">
                        CBD
                    </button>
                    <button onclick="selectCategory(9)" id="btn-9" class="category-btn px-4 py-2 rounded-lg font-bold text-xs uppercase bg-slate-200 text-slate-700">
                        КАЛЬЯНИ
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Chart -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-bold text-slate-900 mb-4">Динаміка Продажів та Частка у Загальному Виторзі</h2>
            <div class="h-96">
                <canvas id="mainChart"></canvas>
            </div>
        </div>

        <!-- Pie Charts Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-900">Розподіл Виторгу</h2>
                    <select id="revenueMonthFilter" onchange="updatePieCharts()" class="px-3 py-1 border border-slate-300 rounded text-sm">
                        <option value="all">Всі місяці</option>
                        <option value="0">Вер '25</option>
                        <option value="1">Жов '25</option>
                        <option value="2">Лис '25</option>
                        <option value="3">Гру '25</option>
                        <option value="4">Січ '26</option>
                    </select>
                </div>
                <div class="h-80">
                    <canvas id="revenuePieChart"></canvas>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-900">Розподіл Прибутку</h2>
                    <select id="marginMonthFilter" onchange="updatePieCharts()" class="px-3 py-1 border border-slate-300 rounded text-sm">
                        <option value="all">Всі місяці</option>
                        <option value="0">Вер '25</option>
                        <option value="1">Жов '25</option>
                        <option value="2">Лис '25</option>
                        <option value="3">Гру '25</option>
                        <option value="4">Січ '26</option>
                    </select>
                </div>
                <div class="h-80">
                    <canvas id="marginPieChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-900">Детальна Таблиця Категорій</h2>
                <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Пошук по категорії..." class="px-4 py-2 border border-slate-300 rounded-lg text-sm">
            </div>
            <div class="overflow-x-auto">
                <table id="dataTable" class="w-full">
                    <thead>
                        <tr class="bg-slate-100">
                            <th class="px-4 py-3 text-left text-sm font-bold text-slate-700 cursor-pointer" onclick="sortTable(0)">
                                Категорія ↕
                            </th>
                            <th class="px-4 py-3 text-right text-sm font-bold text-slate-700 cursor-pointer" onclick="sortTable(1)">
                                Виторг, ₴ ↕
                            </th>
                            <th class="px-4 py-3 text-right text-sm font-bold text-slate-700 cursor-pointer" onclick="sortTable(2)">
                                Прибуток, ₴ ↕
                            </th>
                            <th class="px-4 py-3 text-right text-sm font-bold text-slate-700 cursor-pointer" onclick="sortTable(3)">
                                Маржа, % ↕
                            </th>
                            <th class="px-4 py-3 text-right text-sm font-bold text-slate-700 cursor-pointer" onclick="sortTable(4)">
                                Частка виторгу, % ↕
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const rawData = [
            { cat: 'Готові рідини', revenue: 8984755, margin: 4235212, revH: [1857405, 1861045, 1798970, 1796870, 1670465], marH: [781519, 849594, 891520, 883453, 829124] },
            { cat: 'Картриджі', revenue: 5014629, margin: 1940559, revH: [985614, 921566, 1014386, 1042002, 1050671], marH: [433939, 392112, 384402, 385480, 344599] },
            { cat: 'Компоненти', revenue: 4100968, margin: 1879133, revH: [806958, 698870, 811495, 858213, 925432], marH: [290807, 351588, 344011, 426205, 466518] },
            { cat: 'Поди', revenue: 2376316, margin: 821681, revH: [504001, 436005, 492561, 539194, 404555], marH: [139465, 156963, 171138, 199451, 154663] },
            { cat: 'Чайна суміш', revenue: 338863, margin: 88307, revH: [64537, 61466, 75931, 73419, 63510], marH: [8181, 20669, 18377, 21800, 19277] },
            { cat: 'Випарники', revenue: 265875, margin: 111615, revH: [82095, 44850, 51375, 51985, 35570], marH: [35770, 19224, 21234, 20575, 14810] },
            { cat: 'Одноразки', revenue: 178400, margin: 89932, revH: [0, 1700, 20200, 81200, 75300], marH: [0, 988, 10994, 40284, 37664] },
            { cat: 'Снюс', revenue: 54695, margin: 15310, revH: [11975, 9700, 8675, 11665, 12680], marH: [3579, 2967, 2168, 3205, 3389] },
            { cat: 'CBD', revenue: 68531, margin: 19218, revH: [17965, 14514, 16691, 14562, 4799], marH: [4552, 5326, 4715, 3583, 1040] },
            { cat: 'Кальяни', revenue: 46848, margin: 17765, revH: [8789, 9897, 7724, 10531, 9964], marH: [3833, 3926, 3093, 4026, 2882] }
        ];
        const months = ["Вер '25", "Жов '25", "Лис '25", "Гру '25", "Січ '26"];

        let mainChart, revenuePieChart, marginPieChart;
        let currentCategory = 'all';

        const totalRevenue = rawData.reduce((sum, item) => sum + item.revenue, 0);
        const totalMargin = rawData.reduce((sum, item) => sum + item.margin, 0);

        function init() {
            updateSummaryCards();
            initMainChart();
            initPieCharts();
            populateTable();
        }

        function updateSummaryCards() {
            document.getElementById('totalRevenue').textContent = formatNumber(totalRevenue) + ' ₴';
            document.getElementById('totalMargin').textContent = formatNumber(totalMargin) + ' ₴';
            document.getElementById('marginPercent').textContent = ((totalMargin / totalRevenue) * 100).toFixed(1) + '%';
            document.getElementById('avgMargin').textContent = ((totalMargin / totalRevenue) * 100).toFixed(1) + '%';
        }

        function initMainChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            const revenueByMonth = months.map((_, i) => 
                rawData.reduce((sum, item) => sum + item.revH[i], 0)
            );
            const marginByMonth = months.map((_, i) => 
                rawData.reduce((sum, item) => sum + item.marH[i], 0)
            );
            const shareByMonth = revenueByMonth.map(rev => (rev / totalRevenue) * 100);

            mainChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Виторг, ₴',
                            data: revenueByMonth,
                            borderColor: '#2563eb',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Прибуток, ₴',
                            data: marginByMonth,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderDash: [5, 5],
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Частка у загальному виторзі, %',
                            data: shareByMonth,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0)',
                            tension: 0.4,
                            borderWidth: 2,
                            fill: false,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Сума, ₴',
                                font: { weight: 'bold' }
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value);
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Частка, %',
                                font: { weight: 'bold' }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.dataset.yAxisID === 'y1') {
                                        label += context.parsed.y.toFixed(1) + '%';
                                    } else {
                                        label += formatNumber(context.parsed.y) + ' ₴';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        function initPieCharts() {
            const colors = [
                '#2563eb', '#10b981', '#f59e0b', '#8b5cf6', 
                '#ec4899', '#14b8a6', '#f97316', '#6366f1',
                '#84cc16', '#06b6d4'
            ];

            const ctxRev = document.getElementById('revenuePieChart').getContext('2d');
            revenuePieChart = new Chart(ctxRev, {
                type: 'pie',
                data: {
                    labels: rawData.map(item => item.cat),
                    datasets: [{
                        data: rawData.map(item => item.revenue),
                        backgroundColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return context.label + ': ' + formatNumber(value) + ' ₴ (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });

            const ctxMar = document.getElementById('marginPieChart').getContext('2d');
            marginPieChart = new Chart(ctxMar, {
                type: 'pie',
                data: {
                    labels: rawData.map(item => item.cat),
                    datasets: [{
                        data: rawData.map(item => item.margin),
                        backgroundColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return context.label + ': ' + formatNumber(value) + ' ₴ (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
        }

        function updatePieCharts() {
            const revMonthFilter = document.getElementById('revenueMonthFilter').value;
            const marMonthFilter = document.getElementById('marginMonthFilter').value;

            if (revMonthFilter === 'all') {
                revenuePieChart.data.datasets[0].data = rawData.map(item => item.revenue);
            } else {
                const monthIdx = parseInt(revMonthFilter);
                revenuePieChart.data.datasets[0].data = rawData.map(item => item.revH[monthIdx]);
            }
            revenuePieChart.update();

            if (marMonthFilter === 'all') {
                marginPieChart.data.datasets[0].data = rawData.map(item => item.margin);
            } else {
                const monthIdx = parseInt(marMonthFilter);
                marginPieChart.data.datasets[0].data = rawData.map(item => item.marH[monthIdx]);
            }
            marginPieChart.update();
        }

        function selectCategory(category) {
            currentCategory = category;
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('bg-slate-900', 'bg-blue-600', 'text-white');
                btn.classList.add('bg-slate-200', 'text-slate-700');
            });

            if (category === 'all') {
                document.getElementById('btn-all').classList.remove('bg-slate-200', 'text-slate-700');
                document.getElementById('btn-all').classList.add('bg-slate-900', 'text-white');
                
                const revenueByMonth = months.map((_, i) => 
                    rawData.reduce((sum, item) => sum + item.revH[i], 0)
                );
                const marginByMonth = months.map((_, i) => 
                    rawData.reduce((sum, item) => sum + item.marH[i], 0)
                );
                const shareByMonth = revenueByMonth.map(rev => (rev / totalRevenue) * 100);

                mainChart.data.datasets[0].data = revenueByMonth;
                mainChart.data.datasets[1].data = marginByMonth;
                mainChart.data.datasets[2].data = shareByMonth;
            } else {
                document.getElementById(`btn-${category}`).classList.remove('bg-slate-200', 'text-slate-700');
                document.getElementById(`btn-${category}`).classList.add('bg-blue-600', 'text-white');
                
                const catData = rawData[category];
                const shareByMonth = catData.revH.map(rev => (rev / totalRevenue) * 100);

                mainChart.data.datasets[0].data = catData.revH;
                mainChart.data.datasets[1].data = catData.marH;
                mainChart.data.datasets[2].data = shareByMonth;
            }
            
            mainChart.update();
        }

        function populateTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            rawData.forEach((item, index) => {
                const marginPercent = ((item.margin / item.revenue) * 100).toFixed(1);
                const revenueShare = ((item.revenue / totalRevenue) * 100).toFixed(1);
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td class="px-4 py-3 text-sm font-medium text-slate-900">${item.cat}</td>
                    <td class="px-4 py-3 text-sm text-right text-slate-700">${formatNumber(item.revenue)}</td>
                    <td class="px-4 py-3 text-sm text-right text-green-600 font-medium">${formatNumber(item.margin)}</td>
                    <td class="px-4 py-3 text-sm text-right text-amber-600 font-bold">${marginPercent}%</td>
                    <td class="px-4 py-3 text-sm text-right text-blue-600 font-medium">${revenueShare}%</td>
                `;
                row.classList.add('border-b', 'border-slate-100', 'hover:bg-slate-50', 'transition');
            });
        }

        function filterTable() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toLowerCase();
            const table = document.getElementById('dataTable');
            const rows = table.getElementsByTagName('tr');

            for (let i = 1; i < rows.length; i++) {
                const categoryCell = rows[i].getElementsByTagName('td')[0];
                if (categoryCell) {
                    const txtValue = categoryCell.textContent || categoryCell.innerText;
                    rows[i].style.display = txtValue.toLowerCase().indexOf(filter) > -1 ? '' : 'none';
                }
            }
        }

        function sortTable(columnIndex) {
            const table = document.getElementById('dataTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            const isNumeric = columnIndex > 0;
            
            rows.sort((a, b) => {
                const aText = a.cells[columnIndex].textContent.replace(/[₴,%\s]/g, '');
                const bText = b.cells[columnIndex].textContent.replace(/[₴,%\s]/g, '');
                
                if (isNumeric) {
                    return parseFloat(bText) - parseFloat(aText);
                } else {
                    return aText.localeCompare(bText, 'uk');
                }
            });
            
            rows.forEach(row => tbody.appendChild(row));
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('uk-UA').format(Math.round(num));
        }

        init();
    </script>
</body>
</html>
