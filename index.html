<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª—ñ–∑ –¥–æ–ª–µ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ–π | Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .chart-card { transition: transform 0.2s; }
        .chart-card:hover { transform: translateY(-5px); }
        
        /* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è */
        .sortable { 
            cursor: pointer; 
            position: relative; 
            transition: all 0.2s;
            user-select: none;
        }
        .sortable:hover { background-color: #f1f5f9; color: #4f46e5; }
        
        /* –ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ñ —Å—Ç—Ä—ñ–ª–æ—á–∫–∏ */
        .sort-icon::after { 
            content: '‚Üï'; 
            margin-left: 8px; 
            color: #64748b; /* –¢–µ–º–Ω—ñ—à–∏–π –∫–æ–ª—ñ—Ä –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö —Å—Ç—Ä—ñ–ª–æ–∫ */
            font-size: 1.2em;
            display: inline-block;
            transition: color 0.2s;
        }
        .sortable:hover .sort-icon::after { color: #334155; }
        
        .sort-asc .sort-icon::after { 
            content: '‚Üë'; 
            color: #4f46e5; 
            font-weight: 900;
        }
        .sort-desc .sort-icon::after { 
            content: '‚Üì'; 
            color: #4f46e5; 
            font-weight: 900;
        }
        
        @media print { .no-print { display: none; } }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="report-content" class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-800">üìä –ê–Ω–∞–ª—ñ–∑ –¥–æ–ª–µ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</h1>
                <p class="text-slate-500">–î–µ—Ç–∞–ª—å–Ω–∏–π —Ä–æ–∑—Ä—ñ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–æ—Ö–æ–¥—ñ–≤ —Ç–∞ –ø—Ä–∏–±—É—Ç–∫—É</p>
            </div>
            <button onclick="exportToPDF()" class="no-print bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg font-semibold flex items-center gap-2 shadow-lg transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd" />
                </svg>
                –ï–∫—Å–ø–æ—Ä—Ç —É PDF
            </button>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-slate-500 text-sm font-medium uppercase tracking-wider">–ó–∞–≥–∞–ª—å–Ω–∏–π –í–∞–ª</p>
                <h2 class="text-2xl font-bold text-slate-800">21 468 850 ‚Ç¥</h2>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-slate-500 text-sm font-medium uppercase tracking-wider">–ó–∞–≥–∞–ª—å–Ω–∞ –ú–∞—Ä–∂–∞</p>
                <h2 class="text-2xl font-bold text-emerald-600">9 233 237 ‚Ç¥</h2>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-slate-500 text-sm font-medium uppercase tracking-wider">–°–µ—Ä–µ–¥–Ω—è –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ñ—Å—Ç—å</p>
                <h2 class="text-2xl font-bold text-indigo-600">43.01%</h2>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 chart-card">
                <h3 class="text-lg font-semibold mb-6 text-slate-700 flex items-center gap-2">
                    <span class="w-2 h-6 bg-indigo-500 rounded-full"></span>
                    –ß–∞—Å—Ç–∫–∞ —É –≤–∞–ª–æ–≤–æ–º—É –¥–æ—Ö–æ–¥—ñ (–í–∞–ª)
                </h3>
                <div class="h-80">
                    <canvas id="valChart"></canvas>
                </div>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 chart-card">
                <h3 class="text-lg font-semibold mb-6 text-slate-700 flex items-center gap-2">
                    <span class="w-2 h-6 bg-emerald-500 rounded-full"></span>
                    –ß–∞—Å—Ç–∫–∞ —É –º–∞—Ä–∂—ñ
                </h3>
                <div class="h-80">
                    <canvas id="marginChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Table -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden mb-12">
            <div class="p-6 border-b border-slate-100 bg-slate-50">
                <h3 class="text-lg font-semibold text-slate-700">–ü–æ–∫–∞–∑–Ω–∏–∫–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left" id="analyticsTable">
                    <thead>
                        <tr class="bg-slate-50 text-slate-600 text-xs uppercase tracking-wider border-b border-slate-200">
                            <th class="px-6 py-4 font-bold sortable" onclick="sortTable(0)">
                                <span class="sort-icon">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</span>
                            </th>
                            <th class="px-6 py-4 font-bold text-right sortable" onclick="sortTable(1)">
                                <span class="sort-icon">–í–∞–ª (‚Ç¥)</span>
                            </th>
                            <th class="px-6 py-4 font-bold text-right sortable" onclick="sortTable(2)">
                                <span class="sort-icon">–ú–∞—Ä–∂–∞ (‚Ç¥)</span>
                            </th>
                            <th class="px-6 py-4 font-bold text-right sortable border-l border-slate-200" onclick="sortTable(4)">
                                <span class="sort-icon">–î–æ–ª—è –í–∞–ª—É</span>
                            </th>
                            <th class="px-6 py-4 font-bold text-right sortable" onclick="sortTable(3)">
                                <span class="sort-icon">–î–æ–ª—è –ú–∞—Ä–∂—ñ</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="table-body" class="divide-y divide-slate-100 text-slate-700">
                        <!-- JS injection -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Data sources
        let currentData = [
            { cat: '–ì–æ—Ç–æ–≤—ñ', val: 8984755, margin: 4235212, valShare: '41.85%', marginShare: '45.87%' },
            { cat: '–ö–∞—Ä—Ç—Ä–∏–¥–∂', val: 5014629, margin: 1940559, valShare: '23.36%', marginShare: '21.02%' },
            { cat: '–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏', val: 4100968, margin: 1879133, valShare: '19.10%', marginShare: '20.35%' },
            { cat: '–ü–æ–¥–∏', val: 2376316, margin: 821681, valShare: '11.07%', marginShare: '8.90%' },
            { cat: '–ß–∞–π–Ω–∞ —Å—É–º—ñ—à', val: 338863, margin: 88306, valShare: '1.58%', marginShare: '0.96%' },
            { cat: '–í–∏–ø–∞—Ä–Ω–∏–∫', val: 265875, margin: 111615, valShare: '1.24%', marginShare: '1.21%' },
            { cat: '–û–¥–Ω–æ—Ä–∞–∑–∫–∏', val: 178400, margin: 89932, valShare: '0.83%', marginShare: '0.97%' },
            { cat: 'CBD', val: 68531, margin: 19219, valShare: '0.32%', marginShare: '0.21%' },
            { cat: '–°–Ω—é—Å', val: 54695, margin: 15309, valShare: '0.25%', marginShare: '0.17%' },
            { cat: '–ö–∞–ª—å—è–Ω', val: 46905, margin: 17762, valShare: '0.22%', marginShare: '0.19%' },
            { cat: '–ü–µ—Ä–µ—Ñ–µ—Ä—ñ—è', val: 21000, margin: 4823, valShare: '0.10%', marginShare: '0.05%' },
            { cat: '–ë–æ–Ω–≥ —Ç–∞ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—á—ñ', val: 8793, margin: 4227, valShare: '0.04%', marginShare: '0.05%' },
            { cat: '–ú–µ—Ä—á', val: 7700, margin: 5462, valShare: '0.04%', marginShare: '0.06%' }
        ];

        let sortConfig = { index: null, direction: 'asc' };

        const colors = [
            '#6366f1', '#10b981', '#06b6d4', '#f59e0b', 
            '#ec4899', '#8b5cf6', '#f43f5e', '#14b8a6',
            '#f97316', '#4f46e5', '#d946ef', '#a855f7', '#94a3b8'
        ];

        const formatCur = (num) => new Intl.NumberFormat('uk-UA').format(Math.round(num)) + ' ‚Ç¥';

        function renderTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';
            currentData.forEach(item => {
                const row = `
                    <tr class="hover:bg-slate-50 transition-colors border-b border-slate-50">
                        <td class="px-6 py-4 font-medium text-slate-900">${item.cat}</td>
                        <td class="px-6 py-4 text-right tabular-nums">${formatCur(item.val)}</td>
                        <td class="px-6 py-4 text-right text-emerald-600 font-semibold tabular-nums">${formatCur(item.margin)}</td>
                        <td class="px-6 py-4 text-right border-l border-slate-50 bg-slate-50/30">
                            <span class="bg-slate-200 text-slate-700 px-2.5 py-1 rounded-md text-[11px] font-bold border border-slate-300">${item.valShare}</span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <span class="bg-indigo-100 text-indigo-700 px-2.5 py-1 rounded-md text-[11px] font-bold border border-indigo-200">${item.marginShare}</span>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function sortTable(columnIndex) {
            const headers = document.querySelectorAll('.sortable');
            
            if (sortConfig.index === columnIndex) {
                sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
            } else {
                sortConfig.index = columnIndex;
                sortConfig.direction = 'asc';
            }

            headers.forEach((h) => {
                h.classList.remove('sort-asc', 'sort-desc');
                const headerIndex = parseInt(h.getAttribute('onclick').match(/\d+/)[0]);
                if (headerIndex === columnIndex) {
                    h.classList.add(sortConfig.direction === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            });

            currentData.sort((a, b) => {
                let valA, valB;
                switch(columnIndex) {
                    case 0: valA = a.cat; valB = b.cat; break;
                    case 1: valA = a.val; valB = b.val; break;
                    case 2: valA = a.margin; valB = b.margin; break;
                    case 3: valA = parseFloat(a.marginShare); valB = parseFloat(b.marginShare); break;
                    case 4: valA = parseFloat(a.valShare); valB = parseFloat(b.valShare); break;
                }

                if (valA < valB) return sortConfig.direction === 'asc' ? -1 : 1;
                if (valA > valB) return sortConfig.direction === 'asc' ? 1 : -1;
                return 0;
            });

            renderTable();
        }

        const getCommonOptions = (totalValue) => ({
            responsive: true,
            maintainAspectRatio: false,
            cutout: '65%',
            plugins: {
                legend: { 
                    position: 'right', 
                    labels: { 
                        boxWidth: 10,
                        padding: 15,
                        usePointStyle: true,
                        font: { size: 10, weight: '600' }
                    } 
                },
                tooltip: {
                    backgroundColor: 'rgba(255, 255, 255, 0.98)',
                    titleColor: '#0f172a',
                    titleFont: { weight: 'bold', size: 14 },
                    bodyColor: '#334155',
                    bodyFont: { size: 13 },
                    borderColor: '#cbd5e1',
                    borderWidth: 1,
                    padding: 12,
                    boxPadding: 10,
                    callbacks: {
                        label: function(context) {
                            const value = context.raw;
                            const percentage = ((value / totalValue) * 100).toFixed(2) + '%';
                            return [
                                ` –°—É–º–∞: ${formatCur(value)}`,
                                ` –ß–∞—Å—Ç–∫–∞: ${percentage}`
                            ];
                        }
                    }
                }
            }
        });

        const totalValSum = currentData.reduce((a, b) => a + b.val, 0);
        const totalMarginSum = currentData.reduce((a, b) => a + b.margin, 0);

        renderTable();

        new Chart(document.getElementById('valChart'), {
            type: 'doughnut',
            data: {
                labels: currentData.map(d => d.cat),
                datasets: [{
                    data: currentData.map(d => d.val),
                    backgroundColor: colors,
                    hoverOffset: 15,
                    borderWidth: 2,
                    borderColor: '#ffffff'
                }]
            },
            options: getCommonOptions(totalValSum)
        });

        new Chart(document.getElementById('marginChart'), {
            type: 'doughnut',
            data: {
                labels: currentData.map(d => d.cat),
                datasets: [{
                    data: currentData.map(d => d.margin),
                    backgroundColor: colors,
                    hoverOffset: 15,
                    borderWidth: 2,
                    borderColor: '#ffffff'
                }]
            },
            options: getCommonOptions(totalMarginSum)
        });

        function exportToPDF() {
            const element = document.getElementById('report-content');
            const opt = {
                margin: [10, 10],
                filename: 'Category_Analysis_Report.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
            };
            html2pdf().from(element).set(opt).save();
        }
    </script>
</body>
</html>
