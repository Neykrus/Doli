<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аналітика Продажів - Лінійні Тренди</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f8fafc; color: #1e293b; font-family: 'Inter', sans-serif; }
        .card { background-color: #ffffff; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid #e2e8f0; }
        .chart-container { position: relative; height: 400px; width: 100%; }
        .nav-btn { transition: all 0.2s; border: 1px solid #e2e8f0; }
        .nav-btn.active { background-color: #3b82f6; border-color: #3b82f6; color: white; font-weight: 600; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
        .nav-btn:hover:not(.active) { background-color: #f1f5f9; }
        select { appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1em; }
    </style>
</head>
<body class="p-4 md:p-8 text-slate-800">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4 border-b pb-6 border-slate-200">
            <div>
                <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Центр Аналізу Трендів</h1>
                <p class="text-slate-500 mt-1">Лінійна динаміка та структура часток • 2025-2026</p>
            </div>
        </header>

        <!-- Global Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 text-center">
            <div class="card border-l-4 border-blue-500">
                <p class="text-xs font-bold text-slate-400 uppercase">Загальний Виторг</p>
                <p class="text-3xl font-black text-slate-900 mt-1">21,466,749 ₴</p>
            </div>
            <div class="card border-l-4 border-green-500">
                <p class="text-xs font-bold text-slate-400 uppercase">Валовий Прибуток</p>
                <p class="text-3xl font-black text-slate-900 mt-1">9,233,423 ₴</p>
            </div>
            <div class="card border-l-4 border-purple-500">
                <p class="text-xs font-bold text-slate-400 uppercase">Рентабельність</p>
                <p class="text-3xl font-black text-slate-900 mt-1">43.0%</p>
            </div>
        </div>

        <!-- Structure Charts (Circular) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="card">
                <h2 class="text-lg font-bold mb-6 flex items-center gap-2">
                    <span class="w-2 h-6 bg-blue-500 rounded-full"></span>
                    Структура часток (Виторг)
                </h2>
                <div style="height: 320px;">
                    <canvas id="shareChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h2 class="text-lg font-bold mb-6 flex items-center gap-2">
                    <span class="w-2 h-6 bg-green-500 rounded-full"></span>
                    Структура часток (Прибуток)
                </h2>
                <div style="height: 320px;">
                    <canvas id="marginShareChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Monthly Details Linear Panel -->
        <div class="card mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 border-b pb-6 gap-6">
                <div>
                    <h2 class="text-xl font-bold text-slate-900">Помісячна лінійна динаміка</h2>
                    <p class="text-sm text-slate-500">Оберіть категорію для детального аналізу тренду</p>
                </div>
                <div id="categoryTabs" class="flex flex-wrap gap-2">
                    <!-- Tabs injected by JS -->
                </div>
            </div>
            <div class="chart-container">
                <canvas id="detailChart"></canvas>
            </div>
        </div>

        <!-- Data Table -->
        <div class="card">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4 border-b pb-4">
                <h2 class="text-xl font-bold">Таблиця ключових показників</h2>
                <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                    <!-- Month Filter -->
                    <select id="monthFilter" class="pl-4 pr-10 py-2 text-sm border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none shadow-sm bg-white cursor-pointer">
                        <option value="all">Всі місяці (Зведене)</option>
                        <option value="0">Вересень 2025</option>
                        <option value="1">Жовтень 2025</option>
                        <option value="2">Листопад 2025</option>
                        <option value="3">Грудень 2025</option>
                        <option value="4">Січень 2026</option>
                    </select>
                    <!-- Search -->
                    <div class="relative w-full md:w-64">
                        <input type="text" id="tableSearch" placeholder="Пошук категорії..." class="w-full pl-4 pr-4 py-2 text-sm border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none shadow-sm">
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto mt-4">
                <table class="w-full text-left">
                    <thead>
                        <tr class="text-slate-400 text-xs uppercase border-b bg-slate-50">
                            <th class="py-4 px-4 font-bold cursor-pointer hover:text-blue-600" onclick="handleSort('cat')">Категорія ↑↓</th>
                            <th class="py-4 px-4 font-bold text-right cursor-pointer hover:text-blue-600" onclick="handleSort('revenue')">Виторг ₴ ↑↓</th>
                            <th class="py-4 px-4 font-bold text-right cursor-pointer hover:text-blue-600" onclick="handleSort('margin')">Прибуток ₴ ↑↓</th>
                            <th class="py-4 px-4 font-bold text-right">Маржа %</th>
                        </tr>
                    </thead>
                    <tbody id="mainTable">
                        <!-- Content injected by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const data = [
            { cat: 'Готові рідини', revenue: 8984755, margin: 4235212, revH: [1857405, 1861045, 1798970, 1796870, 1670465], marH: [781519, 849594, 891520, 883453, 829124] },
            { cat: 'Картриджі', revenue: 5014629, margin: 1940559, revH: [985614, 921566, 1014386, 1042002, 1050671], marH: [433939, 392112, 384402, 385480, 344599] },
            { cat: 'Компоненти', revenue: 4100968, margin: 1879133, revH: [806958, 698870, 811495, 858213, 925432], marH: [290807, 351588, 344011, 426205, 466518] },
            { cat: 'Поди', revenue: 2376316, margin: 821681, revH: [504001, 436005, 492561, 539194, 404555], marH: [139465, 156963, 171138, 199451, 154663] },
            { cat: 'Чайна суміш', revenue: 338863, margin: 88307, revH: [64537, 61466, 75931, 73419, 63510], marH: [8181, 20669, 18377, 21800, 19277] },
            { cat: 'Випарники', revenue: 265875, margin: 111615, revH: [82095, 44850, 51375, 51985, 35570], marH: [35770, 19224, 21234, 20575, 14810] },
            { cat: 'Одноразки', revenue: 178400, margin: 89932, revH: [0, 1700, 20200, 81200, 75300], marH: [0, 988, 10994, 40284, 37664] },
            { cat: 'Снюс', revenue: 54695, margin: 15310, revH: [11975, 9700, 8675, 11665, 12680], marH: [3579, 2967, 2168, 3205, 3389] },
            { cat: 'CBD', revenue: 68531, margin: 19218, revH: [17965, 14514, 16691, 14562, 4799], marH: [4552, 5326, 4715, 3583, 1040] },
            { cat: 'Кальяни', revenue: 46848, margin: 17765, revH: [8789, 9897, 7724, 10531, 9964], marH: [3833, 3926, 3093, 4026, 2882] }
        ];

        const months = ["Вер '25", "Жов '25", "Лис '25", "Гру '25", "Січ '26"];
        const palette = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4', '#ec4899', '#64748b', '#0f172a', '#facc15'];
        
        let detailChartInstance = null;
        let activeIndex = 0;
        let sortStatus = { key: 'revenue', dir: -1 };

        function initCircularCharts() {
            new Chart(document.getElementById('shareChart'), {
                type: 'doughnut',
                data: {
                    labels: data.map(d => d.cat),
                    datasets: [{ data: data.map(d => d.revenue), backgroundColor: palette, borderWidth: 0, hoverOffset: 20 }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    cutout: '70%',
                    plugins: { legend: { position: 'right', labels: { boxWidth: 12, font: { size: 11 } } } } 
                }
            });

            new Chart(document.getElementById('marginShareChart'), {
                type: 'pie',
                data: {
                    labels: data.map(d => d.cat),
                    datasets: [{ data: data.map(d => d.margin), backgroundColor: palette, borderWidth: 2, borderColor: '#fff' }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { position: 'right', labels: { boxWidth: 12, font: { size: 11 } } } } 
                }
            });
        }

        function renderTabs() {
            const container = document.getElementById('categoryTabs');
            container.innerHTML = '';
            data.forEach((item, index) => {
                const btn = document.createElement('button');
                btn.className = `nav-btn px-4 py-1.5 rounded-lg text-xs whitespace-nowrap border ${index === activeIndex ? 'active' : 'bg-white text-slate-600 border-slate-200'}`;
                btn.innerText = item.cat;
                btn.onclick = () => {
                    activeIndex = index;
                    renderTabs();
                    updateDetailChart();
                };
                container.appendChild(btn);
            });
        }

        function updateDetailChart() {
            const ctx = document.getElementById('detailChart').getContext('2d');
            const item = data[activeIndex];

            if (detailChartInstance) detailChartInstance.destroy();

            detailChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        { 
                            label: 'Виторг (₴)', 
                            data: item.revH, 
                            borderColor: '#3b82f6', 
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointBackgroundColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        },
                        { 
                            label: 'Прибуток (₴)', 
                            data: item.marH, 
                            borderColor: '#10b981', 
                            backgroundColor: 'rgba(16, 185, 129, 0.05)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointBackgroundColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { beginAtZero: false, grid: { color: '#f1f5f9' }, ticks: { callback: v => v.toLocaleString() + ' ₴' } },
                        x: { grid: { display: false } }
                    },
                    plugins: { 
                        tooltip: { backgroundColor: '#1e293b', padding: 12, titleFont: { size: 14 }, bodySpacing: 6 } 
                    }
                }
            });
        }

        function handleSort(key) {
            if (sortStatus.key === key) sortStatus.dir *= -1;
            else { sortStatus.key = key; sortStatus.dir = -1; }
            renderTable();
        }

        function renderTable() {
            const tbody = document.getElementById('mainTable');
            const term = document.getElementById('tableSearch').value.toLowerCase();
            const monthIdx = document.getElementById('monthFilter').value;
            
            // Map data based on month filter
            const displayData = data.map(item => {
                if (monthIdx === 'all') {
                    return { ...item };
                } else {
                    const idx = parseInt(monthIdx);
                    return {
                        ...item,
                        revenue: item.revH[idx],
                        margin: item.marH[idx]
                    };
                }
            });

            const filteredData = displayData
                .filter(d => d.cat.toLowerCase().includes(term))
                .sort((a, b) => {
                    let vA = a[sortStatus.key];
                    let vB = b[sortStatus.key];
                    return sortStatus.dir === 1 ? (vA > vB ? 1 : -1) : (vA < vB ? 1 : -1);
                });

            tbody.innerHTML = '';
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'border-b border-slate-50 hover:bg-slate-50/50 transition-colors cursor-default';
                const marginPercent = item.revenue > 0 ? ((item.margin / item.revenue) * 100).toFixed(1) : "0.0";
                row.innerHTML = `
                    <td class="py-4 px-4 font-bold text-slate-700">${item.cat}</td>
                    <td class="py-4 px-4 text-right tabular-nums">${item.revenue.toLocaleString()} ₴</td>
                    <td class="py-4 px-4 text-right tabular-nums text-green-600 font-bold">${item.margin.toLocaleString()} ₴</td>
                    <td class="py-4 px-4 text-right"><span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-wider">${marginPercent}%</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        document.getElementById('tableSearch').addEventListener('input', renderTable);
        document.getElementById('monthFilter').addEventListener('change', renderTable);

        window.onload = () => {
            initCircularCharts();
            renderTabs();
            updateDetailChart();
            renderTable();
        };
    </script>
</body>
</html>
